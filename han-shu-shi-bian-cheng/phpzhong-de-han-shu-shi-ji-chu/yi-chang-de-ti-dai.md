# 异常的替代

正如我们刚才所看到的, 如果我们想保持代码的纯净, 就不能使用异常。我们的选择是什么, 以确保我们可以表示一个错误的调用者我们的功能？我们希望我们的解决方案具有以下功能:

* 强制执行错误管理, 以便没有任何错误可以冒泡到最终用户
* 避免样板或复杂的代码结构
* 在我们的功能签名中发布
* 避免将错误误以为正确结果的风险

在本章下一节介绍一种具有所有这些优势的解决方案之前，我们来看看各种方法，在命令式语言中进行错误管理。

为了测试各种方法，我们将尝试实现我们早已使用的max函数：

```php
<?php
function max2(array $data): int
{
    return array_reduce($data, function(int $max, int $i) : int 
    {
        return $i > $max ? $i : $max;
    }, 0);
}
```

因为我们选择了初始值0 , 如果我们使用一个空数组调用函数 , 我们将得到结果0.是否真的是一个空数组的最大值 ? 如果我们调用与PHP自带的函数 , max\(\[\]\)方法会发生什么 ?

> Warning: max\(\): Array must contain at least one element

此外，返回值false。 我们的版本使用值0作为默认值，我们可以将false视为错误代码。 PHP版本还会向您发出警告。

现在我们可以改进这个函数 , 让我们尝试我们拥有的各种选择 , 从最坏的到最好的 .

#### 记录/显示错误消息

正如我们刚刚看到的, PHP 可以显示一个警告消息。我们也可以使用级别通知或错误消息。这可能是最坏的, 你可以做, 因为没有办法让你的功能调用者知道出了问题。一旦应用程序运行, 消息将只显示在日志或屏幕上。

此外，在某些情况下，错误是可以从中恢复的。 由于你不知道发生什么事情，所以在这种情况下你不能这样做。

更糟糕的是, PHP 允许您配置显示哪个错误级别。在大多数情况下, 通知只是隐藏的, 所以没有人会看到在应用程序中的某个地方发生了错误。

为了公平对待PHP，有一种方法可以在运行时使用通过set\_error\_handler参数声明的自定义错误处理程序来捕获这些警告和通知。 但是，为了正确地管理错误，您将不得不找到一种方法来确定处理程序内部是生成错误的函数，并相应地执行。

如果您有多个函数使用这些类型的消息来发出错误信号, 您很快就会有一个真正大的错误处理程序, 或者是大量的较小的, 使得整个过程容易出错, 而且非常繁琐。

#### 错误代码





