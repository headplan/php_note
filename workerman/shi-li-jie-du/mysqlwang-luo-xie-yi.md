# 理解MySQL网络协议

#### 代理

这里以MySQL为例 , 连接MySQL服务可以使用TCP协议 , 例如使用MySQL的客户端连接 , 网络连接 . 如果是在本机 , 也可以使用sock协议 .

这里我们使用自己的服务端当成MySQL服务器 , 然后使用MySQL客户端去连接服务 :

```php
$headplan_worker->onConnect = function ($connection)
{
    echo 'I am MySQL' . PHP_EOL;
};
```

在控制台中可以看到 , 输出的结果I am MySQL . 但是 , 后面的onMessage回调没有被触发 . 也就说明 , 我们的客户端并没有向服务端发送任何消息 , 而是先由服务端向客户端发送消息 , 和我们使用浏览器客户端不一样的是 , 刚好相反 . 简单了解一下握手流程 :

#### **MySQL交互过程**

MySQL客户端与服务器的交互主要分为两个阶段 : 握手认证阶段和命令执行阶段 .

**握手认证阶段**

握手认证阶段为客户端与服务器建立连接后进行 , 交互过程如下 :

* 服务器-&gt;客户端 - 握手初始化消息
* 客户端-&gt;服务器 - 登录认证消息
* 服务器-&gt;客户端 - 认证结果消息

**命令执行阶段**

客户端认证成功后 , 会进入命令执行阶段 , 交互过程如下 :

* 客户端-&gt;服务器 - 执行命令消息
* 服务器-&gt;客户端 - 命令执行结果

**MySQL客户端与服务器的完整交互过程**

![](/assets/mysql_jiaohu.png)

